<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <title>SONGFINDER ♫</title>
</head>
<body class="bg-light">
<nav class="navbar navbar-light bg-dark ">
    <a class="navbar-brand text-light text-warning" href="#">SONGFINDER ♫</a>
</nav>
<div class="container ">
    <div class="row">
        <div class="col-12 p-0 mt-4">
            <form class="form-inline" onsubmit="search(); return false;">

                <div class="col-sm-4 col-md-5 col-lg-7 p-1">
                    <input class="form-control w-100 col-sm-12 col-md-12 col-lg-12" type="search" id="query" placeholder="Sie ist die eine, die immer lacht">
                </div>
                <div class="col-sm-5 col-md-4 col-lg-3 p-1">
                    <div class="input-group ">
                        <div class="input-group-prepend">
                            <label class="input-group-text" for="inputGroupSelect01">Sprache</label>
                        </div>
                        <select class="custom-select" id="inputGroupSelect01">
                            <option selected>deutsch</option>
                            <option value="1">englisch</option>

                        </select>
                    </div>

                </div>
                <div class="col-sm-3 col-md-3 col-lg-2 p-1">
                    <button class="btn btn-primary col-sm-12 col-md-12 col-lg-12 " type="submit">suchen</button>
                </div>
            </form>
        </div>
    </div>

</div>
<div class="container p-0">
    <div class="col-12 p-0" id="counter"></div>
</div>
<div class="container" id="results"></div>
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
<script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>

<script>

    function search() {
        var query = $("#query").val();
        var apiUrl = "http://localhost:8080/api/search?query=" + query;


        var t0 = performance.now();
        $.get(apiUrl, function (result) {

            resultSorted = Object.keys(result).sort(function (a, b) {
                return result[b] - result[a]
            })
            var html = "";
            resultSorted.forEach(function (value) {
                html += "<div class=\"row\">\n" +
                    "<div class=\"col-12 p-2 bg-secondary  mt-4\"><a target='_blank'  class='text-white' href='" + value + "'>" + value + "</a>" +
                    "<button data-url='" + value + "' onclick='onGetDuplicate()' class=\"btn btn-primary\" style=\"\n" +
                    "    float: right;\n" +
                    "\"> Find Duplicate </button>" +
                    "</div>\n" +
                    "</div>";
            });
            $("#results").html(html);
            var t1 = performance.now();
            var time = t1 - t0;
            $("#counter").html("<b>results:</b> " + resultSorted.length + " - <b>elapsed time:</b> " + time + " Miliseconds");

        });
    }

    function onGetDuplicate() {
        const btn = event.srcElement;
        const url = btn.getAttribute("data-url");
        fetch(`/api/duplicate?url=${url}`, {
            method: "GET",
        }).then((response) => {
            response.json().then((jsonResult) => {
                const resultArray = jsonResult.result.split(",");
                let html = "";

                resultArray.forEach((url) => {
                    html += "<div class=\"row\">\n" +
                        "<div class=\"col-12 p-2 bg-secondary  mt-4\"><a target='_blank'  class='text-white' href='" + url + "'>" + url + "</a>" +
                        "</div>\n" +
                        "</div>";
                });

                $("#results").html(html);
            })
        })
    }
</script>
</body>
</html>
